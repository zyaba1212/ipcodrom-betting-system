{% extends "betting/base.html" %}

{% block title %}–°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É - –ò–ø–ø–æ–¥—Ä–æ–º{% endblock %}

{% block content %}
<div class="betting-container">
    <h2>üéØ –°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É</h2>
    
    <form method="post" class="bet-form">
        {% csrf_token %}
        
        <div class="form-group">
            <label for="id_race">–í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–±–µ–≥:</label>
            {{ form.race }}
        </div>
        
        <div class="form-group">
            <label for="id_horse">–í—ã–±–µ—Ä–∏—Ç–µ –ª–æ—à–∞–¥—å:</label>
            {{ form.horse }}
        </div>
        
        <div class="form-group">
            <label for="id_amount">–°—É–º–º–∞ —Å—Ç–∞–≤–∫–∏ (‚ÇΩ):</label>
            {{ form.amount }}
            <small>–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞: 10‚ÇΩ. –í–∞—à –±–∞–ª–∞–Ω—Å: {{ user.profile.balance }}‚ÇΩ</small>
        </div>
        
        <div class="potential-win">
            <strong>–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –≤—ã–∏–≥—Ä—ã—à: <span id="potential-win">0</span>‚ÇΩ</strong>
        </div>
        
        <button type="submit" class="btn-primary">–°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É</button>
    </form>
    
    <div class="available-races">
        <h3>üèá –î–æ—Å—Ç—É–ø–Ω—ã–µ –∑–∞–±–µ–≥–∏</h3>
        {% for race in races %}
        <div class="race-card">
            <h4>{{ race.name }}</h4>
            <p><strong>–í—Ä–µ–º—è:</strong> {{ race.date_time|date:"d.m.Y –≤ H:i" }}</p>
            <p><strong>–î–∏—Å—Ç–∞–Ω—Ü–∏—è:</strong> {{ race.distance }} –º</p>
            <p><strong>–õ–æ—à–∞–¥–∏:</strong></p>
            <ul>
                {% for horse in race.horses.all %}
                <li>{{ horse.name }} (–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç: {{ horse.odds }})</li>
                {% endfor %}
            </ul>
        </div>
        {% endfor %}
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const horseSelect = document.getElementById('id_horse');
    const amountInput = document.getElementById('id_amount');
    const potentialWinSpan = document.getElementById('potential-win');
    
    function calculateWin() {
        const selectedHorse = horseSelect.options[horseSelect.selectedIndex];
        const odds = parseFloat(selectedHorse.getAttribute('data-odds')) || 0;
        const amount = parseFloat(amountInput.value) || 0;
        const potentialWin = (odds * amount).toFixed(2);
        potentialWinSpan.textContent = potentialWin;
    }
    
    horseSelect.addEventListener('change', calculateWin);
    amountInput.addEventListener('input', calculateWin);
});
</script>
{% endblock %}