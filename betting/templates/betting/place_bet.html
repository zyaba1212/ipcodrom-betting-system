{% extends "betting/base.html" %}

{% block title %}–°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É - –ò–ø–ø–æ–¥—Ä–æ–º{% endblock %}

{% block content %}
<div class="betting-container">
    <div class="betting-header">
        <h1>üéØ –°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É</h1>
        <p>–í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–±–µ–≥ –∏ —Å–¥–µ–ª–∞–π—Ç–µ —Å–≤–æ—é —Å—Ç–∞–≤–∫—É</p>
    </div>

    <div class="betting-content">
        <!-- –§–æ—Ä–º–∞ —Å—Ç–∞–≤–∫–∏ -->
        <div class="bet-form-card">
            <h2>üìù –í–∞—à–∞ —Å—Ç–∞–≤–∫–∞</h2>
            <form method="post" class="bet-form">
                {% csrf_token %}
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="race">–í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–±–µ–≥</label>
                        <select id="race" name="race" required>
                            <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–±–µ–≥ --</option>
                            {% for race in races %}
                            <option value="{{ race.id }}">{{ race.name }} - {{ race.date_time|date:"d.m.Y H:i" }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="horse">–í—ã–±–µ—Ä–∏—Ç–µ –ª–æ—à–∞–¥—å</label>
                        <select id="horse" name="horse" required>
                            <option value="">-- –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∑–∞–±–µ–≥ --</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="amount">–°—É–º–º–∞ —Å—Ç–∞–≤–∫–∏ (‚ÇΩ)</label>
                    <input type="number" id="amount" name="amount" min="10" 
                           step="10" required placeholder="–ú–∏–Ω–∏–º—É–º 10 ‚ÇΩ">
                    <div class="balance-info">
                        –í–∞—à –±–∞–ª–∞–Ω—Å: <strong>{{ user.profile.balance|default:"0" }} ‚ÇΩ</strong>
                    </div>
                </div>
                
                <div class="potential-win">
                    <h3>üíé –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –≤—ã–∏–≥—Ä—ã—à: <span id="potentialWin">0 ‚ÇΩ</span></h3>
                </div>
                
                <button type="submit" class="btn btn-primary btn-full">
                    üéØ –°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É
                </button>
            </form>
        </div>

        <!-- –°–ø–∏—Å–æ–∫ –∑–∞–±–µ–≥–æ–≤ -->
        <div class="races-list">
            <h2>üèá –î–æ—Å—Ç—É–ø–Ω—ã–µ –∑–∞–±–µ–≥–∏</h2>
            
            {% for race in races %}
            <div class="race-card-expanded" onclick="selectRace({{ race.id }})">
                <div class="race-header">
                    <h3>{{ race.name }}</h3>
                    <span class="race-time">{{ race.date_time|date:"d.m.Y –≤ H:i" }}</span>
                </div>
                
                <div class="race-details">
                    <div class="race-info">
                        <span class="info-item">üìç –î–∏—Å—Ç–∞–Ω—Ü–∏—è: 1600 –º</span>
                        <span class="info-item">üë• –£—á–∞—Å—Ç–Ω–∏–∫–æ–≤: 5</span>
                        <span class="info-item">‚è±Ô∏è –°—Ç–∞—Ç—É—Å: –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω</span>
                    </div>
                    
                    <div class="horses-grid">
                        <div class="horse-card">
                            <div class="horse-name">–ú–æ–ª–Ω–∏—è</div>
                            <div class="horse-odds">2.50</div>
                        </div>
                        <div class="horse-card">
                            <div class="horse-name">–í–µ—Ç–µ—Ä</div>
                            <div class="horse-odds">3.00</div>
                        </div>
                        <div class="horse-card">
                            <div class="horse-name">–ì—Ä–æ–º</div>
                            <div class="horse-odds">4.50</div>
                        </div>
                        <div class="horse-card">
                            <div class="horse-name">–ó–≤–µ–∑–¥–∞</div>
                            <div class="horse-odds">2.80</div>
                        </div>
                        <div class="horse-card">
                            <div class="horse-name">–ë—É—Ä—è</div>
                            <div class="horse-odds">5.00</div>
                        </div>
                    </div>
                </div>
                
                <button class="btn btn-small" onclick="event.stopPropagation(); selectRace({{ race.id }})">
                    –í—ã–±—Ä–∞—Ç—å –¥–ª—è —Å—Ç–∞–≤–∫–∏
                </button>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<script>
function selectRace(raceId) {
    document.getElementById('race').value = raceId;
    // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –ª–æ—à–∞–¥–µ–π –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∑–∞–±–µ–≥–∞
    updateHorses(raceId);
}

function updateHorses(raceId) {
    const horseSelect = document.getElementById('horse');
    horseSelect.innerHTML = '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –ª–æ—à–∞–¥—å --</option>';
    
    // –ó–∞–≥–ª—É—à–∫–∞ - –≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å AJAX –∑–∞–ø—Ä–æ—Å
    const horses = [
        {id: 1, name: '–ú–æ–ª–Ω–∏—è', odds: 2.50},
        {id: 2, name: '–í–µ—Ç–µ—Ä', odds: 3.00},
        {id: 3, name: '–ì—Ä–æ–º', odds: 4.50},
        {id: 4, name: '–ó–≤–µ–∑–¥–∞', odds: 2.80},
        {id: 5, name: '–ë—É—Ä—è', odds: 5.00}
    ];
    
    horses.forEach(horse => {
        const option = document.createElement('option');
        option.value = horse.id;
        option.textContent = `${horse.name} (–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç: ${horse.odds})`;
        option.dataset.odds = horse.odds;
        horseSelect.appendChild(option);
    });
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–≥–æ –≤—ã–∏–≥—Ä—ã—à–∞
document.getElementById('amount').addEventListener('input', updatePotentialWin);
document.getElementById('horse').addEventListener('change', updatePotentialWin);

function updatePotentialWin() {
    const amount = parseFloat(document.getElementById('amount').value) || 0;
    const horseSelect = document.getElementById('horse');
    const selectedOption = horseSelect.options[horseSelect.selectedIndex];
    const odds = parseFloat(selectedOption.dataset.odds) || 0;
    
    const potentialWin = amount * odds;
    document.getElementById('potentialWin').textContent = potentialWin.toFixed(2) + ' ‚ÇΩ';
}
</script>
{% endblock %}