{% extends 'betting/base.html' %}
{% load static %}

{% block title %}–ì–ª–∞–≤–Ω–∞—è - –°–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–≤–æ–∫{% endblock %}

{% block content %}
<div class="welcome-section card">
    <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –ò–ø–ø–æ–¥—Ä–æ–º!</h1>
    <p>–ò—Å–ø—ã—Ç–∞–π—Ç–µ —É–¥–∞—á—É –≤ —Å–∞–º—ã—Ö –∑–∞—Ö–≤–∞—Ç—ã–≤–∞—é—â–∏—Ö —Å–∫–∞—á–∫–∞—Ö —Å–µ–∑–æ–Ω–∞!</p>
    
    {% if user.is_authenticated %}
    <div class="user-welcome">
        <h2>–ü—Ä–∏–≤–µ—Ç, {{ user.username }}! üéØ</h2>
        <div class="balance-info">
            <span class="balance-label">–í–∞—à –±–∞–ª–∞–Ω—Å:</span>
            <span class="balance-amount">{{ user.betting_profile.balance }} ‚ÇΩ</span>
        </div>
    </div>
    {% endif %}
</div>

{% if user.is_authenticated %}
<div class="grid grid-2">
    <div class="card">
        <div class="card-header">
            <h2 class="card-title">–í–∞—à –∏–≥—Ä–æ–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å</h2>
        </div>
        <div class="player-stats">
            <div class="level-badge">
                <div class="level-icon">üèÜ</div>
                <div class="level-info">
                    <div class="level-name">{{ player_level }}</div>
                    <div class="level-desc">{{ level_description }}</div>
                </div>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value">{{ total_bets }}</div>
                    <div class="stat-label">–í—Å–µ–≥–æ —Å—Ç–∞–≤–æ–∫</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value {% if win_rate >= 30 %}stat-positive{% elif win_rate >= 15 %}stat-neutral{% else %}stat-negative{% endif %}">
                        {{ win_rate }}%
                    </div>
                    <div class="stat-label">–ü—Ä–æ—Ü–µ–Ω—Ç –ø–æ–±–µ–¥</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">{{ active_bets }}</div>
                    <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã–µ —Å—Ç–∞–≤–∫–∏</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value stat-positive">+{{ total_won }} ‚ÇΩ</div>
                    <div class="stat-label">–û–±—â–∏–π –≤—ã–∏–≥—Ä—ã—à</div>
                </div>
            </div>
            
            <div class="next-goal">
                <h3>üéØ –°–ª–µ–¥—É—é—â–∞—è —Ü–µ–ª—å</h3>
                <p>{{ next_goal }}</p>
            </div>
            
            <div class="motivation-tip">
                <h3>üí° –°–æ–≤–µ—Ç –¥–Ω—è</h3>
                <p>–ò–∑—É—á–∞–π—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ª–æ—à–∞–¥–µ–π - —Ñ–∞–≤–æ—Ä–∏—Ç—ã –≤—ã–∏–≥—Ä—ã–≤–∞—é—Ç —á–∞—â–µ, –Ω–æ –∞—É—Ç—Å–∞–π–¥–µ—Ä—ã –ø—Ä–∏–Ω–æ—Å—è—Ç –±–æ–ª—å—à–µ!</p>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <h2 class="card-title">–ë–ª–∏–∂–∞–π—à–∏–µ –∑–∞–±–µ–≥–∏</h2>
        </div>
        <div class="race-list">
            {% for race in upcoming_races %}
            <div class="race-card upcoming">
                <div class="race-header">
                    <div class="race-name">{{ race.name }}</div>
                    <div class="race-status status-scheduled">{{ race.get_status_display }}</div>
                </div>
                <div class="race-time">
                    <span class="race-timer" data-start-time="{{ race.start_time|date:'c' }}">
                        {{ race.start_time }}
                    </span>
                </div>
                <div class="race-horses">
                    {% for horse in race.horses.all|slice:":3" %}
                    <span class="horse-badge">{{ horse.name }} ({{ horse.odds }})</span>
                    {% endfor %}
                </div>
                <a href="{% url 'betting:place_bet_race' race.id %}" class="btn btn-primary btn-block">
                    üêé –°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É
                </a>
            </div>
            {% empty %}
            <div class="no-races">
                <p>–ù–µ—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–±–µ–≥–æ–≤</p>
                <p>–ù–æ–≤—ã–µ –∑–∞–±–µ–≥–∏ –ø–æ—è–≤—è—Ç—Å—è —Å–∫–æ—Ä–æ!</p>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

{% else %}
<div class="grid grid-2">
    <div class="card">
        <div class="card-header">
            <h2 class="card-title">–ë–ª–∏–∂–∞–π—à–∏–µ –∑–∞–±–µ–≥–∏</h2>
        </div>
        <div class="race-list">
            {% for race in upcoming_races %}
            <div class="race-card upcoming">
                <div class="race-header">
                    <div class="race-name">{{ race.name }}</div>
                    <div class="race-status status-scheduled">{{ race.get_status_display }}</div>
                </div>
                <div class="race-time">
                    <span class="race-timer" data-start-time="{{ race.start_time|date:'c' }}">
                        {{ race.start_time }}
                    </span>
                </div>
                <div class="race-horses">
                    {% for horse in race.horses.all|slice:":3" %}
                    <span class="horse-badge">{{ horse.name }} ({{ horse.odds }})</span>
                    {% endfor %}
                </div>
            </div>
            {% empty %}
            <div class="no-races">
                <p>–ù–µ—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–±–µ–≥–æ–≤</p>
            </div>
            {% endfor %}
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <h2 class="card-title">–ü–æ—á–µ–º—É —Å—Ç–æ–∏—Ç –∏–≥—Ä–∞—Ç—å?</h2>
        </div>
        <div class="features-list">
            <div class="feature-item">
                <span class="feature-icon">üí∞</span>
                <div class="feature-text">
                    <strong>–ù–∞—á–∞–ª—å–Ω—ã–π –±–æ–Ω—É—Å 1000 ‚ÇΩ</strong>
                    <p>–î–ª—è –≤—Å–µ—Ö –Ω–æ–≤—ã—Ö –∏–≥—Ä–æ–∫–æ–≤</p>
                </div>
            </div>
            <div class="feature-item">
                <span class="feature-icon">üèá</span>
                <div class="feature-text">
                    <strong>–†–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ —Å–∫–∞—á–∫–∏</strong>
                    <p>–ù–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏</p>
                </div>
            </div>
            <div class="feature-item">
                <span class="feature-icon">‚ö°</span>
                <div class="feature-text">
                    <strong>–ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ –≤—ã–ø–ª–∞—Ç—ã</strong>
                    <p>–í—ã–∏–≥—Ä—ã—à–∏ —Å—Ä–∞–∑—É –Ω–∞ –±–∞–ª–∞–Ω—Å</p>
                </div>
            </div>
            <div class="feature-item">
                <span class="feature-icon">üìä</span>
                <div class="feature-text">
                    <strong>–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</strong>
                    <p>–û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ —Å–≤–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å</p>
                </div>
            </div>
        </div>
        <div class="auth-promo">
            <a href="{% url 'betting:register' %}" class="btn btn-success btn-block">–ù–∞—á–∞—Ç—å –∏–≥—Ä–∞—Ç—å</a>
            <p>–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <a href="{% url 'betting:login' %}">–í–æ–π–¥–∏—Ç–µ</a></p>
        </div>
    </div>
</div>
{% endif %}

{% if recent_races %}
<div class="card">
    <div class="card-header">
        <h2 class="card-title">–ù–µ–¥–∞–≤–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</h2>
    </div>
    <div class="race-list">
        {% for race in recent_races %}
        <div class="race-card finished">
            <div class="race-header">
                <div class="race-name">{{ race.name }}</div>
                <div class="race-status status-finished">{{ race.get_status_display }}</div>
            </div>
            {% if race.winner %}
            <div class="race-winner">
                üèÜ –ü–æ–±–µ–¥–∏—Ç–µ–ª—å: <strong>{{ race.winner.name }}</strong>
            </div>
            {% endif %}
            <div class="race-time">{{ race.start_time }}</div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}
{% endblock %}